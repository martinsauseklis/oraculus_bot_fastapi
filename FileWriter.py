from agents import function_tool
import os


# @function_tool
def file_writer(file_path: str, text: str):
    """file_path: full file path like data/file.json"""
    if os.path.exists(file_path):
        raise Exception({
            "success": False,
            "message": "File already exists"
        })
    else:
        with open(file_path, "w+") as f:
            f.write(text)

        return {
            "success": True
        }


print(file_writer(
    file_path="shipments-app/src/App.jsx",
    text="import { useMemo, useState } from \"react\";\nimport initialShipments from \"./data/shipments.json\";\n\nconst STORAGE_KEY = \"shipmentsData\";\n\nconst getStoredShipments = () => {\n  if (typeof window === \"undefined\") return initialShipments;\n  const saved = window.localStorage.getItem(STORAGE_KEY);\n  return saved ? JSON.parse(saved) : initialShipments;\n};\n\nconst uniqueValues = (items, key) =>\n  Array.from(new Set(items.map((item) => item[key]).filter(Boolean))).sort();\n\nconst padTracking = (value) => String(value).padStart(9, \"0\");\n\nconst getNextTrackingNumber = (shipments) => {\n  const maxNumber = shipments.reduce((max, shipment) => {\n    const numeric = Number(String(shipment.tracking_number || \"\").replace(/\\D/g, \"\"));\n    return Number.isNaN(numeric) ? max : Math.max(max, numeric);\n  }, 0);\n  return `DPD${padTracking(maxNumber + 1)}`;\n};\n\nconst getNextShipmentId = (shipments) => {\n  const maxId = shipments.reduce(\n    (max, shipment) => Math.max(max, Number(shipment.shipment_id) || 0),\n    0\n  );\n  return String(maxId + 1);\n};\n\nconst defaultForm = () => {\n  const now = new Date();\n  const estimated = new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000);\n  return {\n    reference_number: \"\",\n    sender_name: \"\",\n    sender_country: \"\",\n    sender_city: \"\",\n    sender_postcode: \"\",\n    recipient_name: \"\",\n    recipient_country: \"\",\n    recipient_city: \"\",\n    recipient_postcode: \"\",\n    service_type: \"STANDARD\",\n    shipment_status: \"CREATED\",\n    weight_kg: \"\",\n    length_cm: \"\",\n    width_cm: \"\",\n    height_cm: \"\",\n    cash_on_delivery: false,\n    cod_amount_eur: \"\",\n    insured: false,\n    insurance_amount_eur: \"\",\n    pickup_timestamp: now.toISOString(),\n    estimated_delivery: estimated.toISOString(),\n    delivered_timestamp: \"\",\n    delivery_attempts: 0,\n    last_hub_code: \"HUB-1\",\n  };\n};\n\nexport default function App() {\n  const [shipments, setShipments] = useState(getStoredShipments);\n  const [search, setSearch] = useState(\"\");\n  const [statusFilters, setStatusFilters] = useState([]);\n  const [serviceFilters, setServiceFilters] = useState([]);\n  const [senderCountryFilters, setSenderCountryFilters] = useState([]);\n  const [recipientCountryFilters, setRecipientCountryFilters] = useState([]);\n  const [form, setForm] = useState(defaultForm());\n  const [notice, setNotice] = useState(\"\");\n\n  const options = useMemo(\n    () => ({\n      statuses: uniqueValues(shipments, \"shipment_status\"),\n      services: uniqueValues(shipments, \"service_type\"),\n      senderCountries: uniqueValues(shipments, \"sender_country\"),\n      recipientCountries: uniqueValues(shipments, \"recipient_country\"),\n    }),\n    [shipments]\n  );\n\n  const filteredShipments = useMemo(() => {\n    const term = search.trim().toLowerCase();\n    return shipments.filter((shipment) => {\n      const matchesTerm = term\n        ? [\n            shipment.tracking_number,\n            shipment.reference_number,\n            shipment.sender_name,\n            shipment.recipient_name,\n          ]\n            .filter(Boolean)\n            .some((value) => String(value).toLowerCase().includes(term))\n        : true;\n\n      const matchesStatus = statusFilters.length\n        ? statusFilters.includes(shipment.shipment_status)\n        : true;\n\n      const matchesService = serviceFilters.length\n        ? serviceFilters.includes(shipment.service_type)\n        : true;\n\n      const matchesSender = senderCountryFilters.length\n        ? senderCountryFilters.includes(shipment.sender_country)\n        : true;\n\n      const matchesRecipient = recipientCountryFilters.length\n        ? recipientCountryFilters.includes(shipment.recipient_country)\n        : true;\n\n      return (\n        matchesTerm &&\n        matchesStatus &&\n        matchesService &&\n        matchesSender &&\n        matchesRecipient\n      );\n    });\n  }, [\n    shipments,\n    search,\n    statusFilters,\n    serviceFilters,\n    senderCountryFilters,\n    recipientCountryFilters,\n  ]);\n\n  const toggleFilter = (value, list, setter) => {\n    if (list.includes(value)) {\n      setter(list.filter((item) => item !== value));\n    } else {\n      setter([...list, value]);\n    }\n  };\n\n  const resetFilters = () => {\n    setSearch(\"\");\n    setStatusFilters([]);\n    setServiceFilters([]);\n    setSenderCountryFilters([]);\n    setRecipientCountryFilters([]);\n  };\n\n  const handleChange = (event) => {\n    const { name, value, type, checked } = event.target;\n    setForm((prev) => ({\n      ...prev,\n      [name]: type === \"checkbox\" ? checked : value,\n    }));\n  };\n\n  const handleSubmit = (event) => {\n    event.preventDefault();\n    const nextShipment = {\n      shipment_id: getNextShipmentId(shipments),\n      tracking_number: getNextTrackingNumber(shipments),\n      reference_number: form.reference_number || `REF-${Date.now()}`,\n      sender_name: form.sender_name || \"Unknown Sender\",\n      sender_country: form.sender_country || \"N/A\",\n      sender_city: form.sender_city || \"\",\n      sender_postcode: form.sender_postcode || \"\",\n      recipient_name: form.recipient_name || \"Unknown Recipient\",\n      recipient_country: form.recipient_country || \"N/A\",\n      recipient_city: form.recipient_city || \"\",\n      recipient_postcode: form.recipient_postcode || \"\",\n      service_type: form.service_type,\n      shipment_status: form.shipment_status,\n      weight_kg: form.weight_kg || \"0\",\n      length_cm: Number(form.length_cm) || 0,\n      width_cm: Number(form.width_cm) || 0,\n      height_cm: Number(form.height_cm) || 0,\n      cash_on_delivery: form.cash_on_delivery,\n      cod_amount_eur: form.cash_on_delivery ? form.cod_amount_eur || \"0\" : null,\n      insured: form.insured,\n      insurance_amount_eur: form.insured ? form.insurance_amount_eur || \"0\" : null,\n      pickup_timestamp: form.pickup_timestamp || new Date().toISOString(),\n      estimated_delivery: form.estimated_delivery || new Date().toISOString(),\n      delivered_timestamp: form.delivered_timestamp || null,\n      delivery_attempts: Number(form.delivery_attempts) || 0,\n      last_hub_code: form.last_hub_code || \"HUB-1\",\n      created_at: new Date().toISOString(),\n    };\n\n    const updated = [nextShipment, ...shipments];\n    setShipments(updated);\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));\n    setNotice(`Shipment added. Tracking number: ${nextShipment.tracking_number}`);\n    setForm(defaultForm());\n  };\n\n  const persistNow = () => {\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(shipments));\n    setNotice(\"Shipments saved to local storage.\");\n  };\n\n  return (\n    <div className=\"app\">\n      <header>\n        <h1>Shipments Control Center</h1>\n        <p>Filter by multiple values and add new shipments with auto-generated tracking numbers.</p>\n      </header>\n\n      {notice && (\n        <div className=\"section\" role=\"status\">\n          <strong>{notice}</strong>\n        </div>\n      )}\n\n      <section className=\"section\">\n        <h2>Filters</h2>\n        <div className=\"grid grid-2\">\n          <div>\n            <label htmlFor=\"search\">Search</label>\n            <input\n              id=\"search\"\n              placeholder=\"Tracking, reference, sender, recipient\"\n              value={search}\n              onChange={(event) => setSearch(event.target.value)}\n            />\n          </div>\n          <div className=\"actions\" style={{ alignItems: \"flex-end\" }}>\n            <button className=\"secondary\" type=\"button\" onClick={resetFilters}>\n              Reset filters\n            </button>\n            <button className=\"secondary\" type=\"button\" onClick={persistNow}>\n              Save to local storage\n            </button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-2\" style={{ marginTop: 16 }}>\n          <fieldset>\n            <legend>Status</legend>\n            <div className=\"checkbox-list\">\n              {options.statuses.map((status) => (\n                <label key={status} className=\"checkbox-item\">\n                  <input\n                    type=\"checkbox\"\n                    checked={statusFilters.includes(status)}\n                    onChange={() => toggleFilter(status, statusFilters, setStatusFilters)}\n                  />\n                  {status}\n                </label>\n              ))}\n            </div>\n          </fieldset>\n          <fieldset>\n            <legend>Service Type</legend>\n            <div className=\"checkbox-list\">\n              {options.services.map((service) => (\n                <label key={service} className=\"checkbox-item\">\n                  <input\n                    type=\"checkbox\"\n                    checked={serviceFilters.includes(service)}\n                    onChange={() => toggleFilter(service, serviceFilters, setServiceFilters)}\n                  />\n                  {service}\n                </label>\n              ))}\n            </div>\n          </fieldset>\n        </div>\n\n        <div className=\"grid grid-2\" style={{ marginTop: 16 }}>\n          <fieldset>\n            <legend>Sender Country</legend>\n            <div className=\"checkbox-list\">\n              {options.senderCountries.map((country) => (\n                <label key={country} className=\"checkbox-item\">\n                  <input\n                    type=\"checkbox\"\n                    checked={senderCountryFilters.includes(country)}\n                    onChange={() =>\n                      toggleFilter(country, senderCountryFilters, setSenderCountryFilters)\n                    }\n                  />\n                  {country}\n                </label>\n              ))}\n            </div>\n          </fieldset>\n          <fieldset>\n            <legend>Recipient Country</legend>\n            <div className=\"checkbox-list\">\n              {options.recipientCountries.map((country) => (\n                <label key={country} className=\"checkbox-item\">\n                  <input\n                    type=\"checkbox\"\n                    checked={recipientCountryFilters.includes(country)}\n                    onChange={() =>\n                      toggleFilter(country, recipientCountryFilters, setRecipientCountryFilters)\n                    }\n                  />\n                  {country}\n                </label>\n              ))}\n            </div>\n          </fieldset>\n        </div>\n\n        <p className=\"footer-note\">\n          Showing {filteredShipments.length} of {shipments.length} shipments.\n        </p>\n      </section>\n\n      <section className=\"section\">\n        <h2>Add New Shipment</h2>\n        <form onSubmit={handleSubmit} className=\"grid grid-3\">\n          <div>\n            <label>Reference Number</label>\n            <input name=\"reference_number\" value={form.reference_number} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Sender Name</label>\n            <input name=\"sender_name\" value={form.sender_name} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Sender Country</label>\n            <input name=\"sender_country\" value={form.sender_country} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Sender City</label>\n            <input name=\"sender_city\" value={form.sender_city} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Sender Postcode</label>\n            <input name=\"sender_postcode\" value={form.sender_postcode} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Recipient Name</label>\n            <input name=\"recipient_name\" value={form.recipient_name} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Recipient Country</label>\n            <input name=\"recipient_country\" value={form.recipient_country} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Recipient City</label>\n            <input name=\"recipient_city\" value={form.recipient_city} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Recipient Postcode</label>\n            <input name=\"recipient_postcode\" value={form.recipient_postcode} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Service Type</label>\n            <select name=\"service_type\" value={form.service_type} onChange={handleChange}>\n              <option value=\"STANDARD\">STANDARD</option>\n              <option value=\"EXPRESS\">EXPRESS</option>\n              <option value=\"INTERNATIONAL\">INTERNATIONAL</option>\n            </select>\n          </div>\n          <div>\n            <label>Status</label>\n            <select name=\"shipment_status\" value={form.shipment_status} onChange={handleChange}>\n              <option value=\"CREATED\">CREATED</option>\n              <option value=\"PICKED_UP\">PICKED_UP</option>\n              <option value=\"IN_TRANSIT\">IN_TRANSIT</option>\n              <option value=\"OUT_FOR_DELIVERY\">OUT_FOR_DELIVERY</option>\n              <option value=\"DELIVERED\">DELIVERED</option>\n              <option value=\"FAILED\">FAILED</option>\n            </select>\n          </div>\n          <div>\n            <label>Weight (kg)</label>\n            <input name=\"weight_kg\" value={form.weight_kg} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Length (cm)</label>\n            <input name=\"length_cm\" value={form.length_cm} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Width (cm)</label>\n            <input name=\"width_cm\" value={form.width_cm} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Height (cm)</label>\n            <input name=\"height_cm\" value={form.height_cm} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Pickup Timestamp</label>\n            <input name=\"pickup_timestamp\" value={form.pickup_timestamp} onChange={handleChange} />\n          </div>\n          <div>\n            <label>Estimated Delivery</label>\n            <input\n              name=\"estimated_delivery\"\n              value={form.estimated_delivery}\n              onChange={handleChange}\n            />\n          </div>\n          <div>\n            <label>Delivered Timestamp</label>\n            <input\n              name=\"delivered_timestamp\"\n              value={form.delivered_timestamp}\n              onChange={handleChange}\n            />\n          </div>\n          <div>\n            <label>Delivery Attempts</label>\n            <input\n              name=\"delivery_attempts\"\n              value={form.delivery_attempts}\n              onChange={handleChange}\n            />\n          </div>\n          <div>\n            <label>Last Hub Code</label>\n            <input name=\"last_hub_code\" value={form.last_hub_code} onChange={handleChange} />\n          </div>\n          <div>\n            <label className=\"checkbox-item\" style={{ marginTop: 8 }}>\n              <input\n                type=\"checkbox\"\n                name=\"cash_on_delivery\"\n                checked={form.cash_on_delivery}\n                onChange={handleChange}\n              />\n              Cash on delivery\n            </label>\n            {form.cash_on_delivery && (\n              <input\n                name=\"cod_amount_eur\"\n                placeholder=\"COD amount (EUR)\"\n                value={form.cod_amount_eur}\n                onChange={handleChange}\n              />\n            )}\n          </div>\n          <div>\n            <label className=\"checkbox-item\" style={{ marginTop: 8 }}>\n              <input\n                type=\"checkbox\"\n                name=\"insured\"\n                checked={form.insured}\n                onChange={handleChange}\n              />\n              Insured\n            </label>\n            {form.insured && (\n              <input\n                name=\"insurance_amount_eur\"\n                placeholder=\"Insurance amount (EUR)\"\n                value={form.insurance_amount_eur}\n                onChange={handleChange}\n              />\n            )}\n          </div>\n          <div className=\"actions\" style={{ alignItems: \"flex-end\" }}>\n            <button type=\"submit\">Add shipment</button>\n          </div>\n        </form>\n      </section>\n\n      <section className=\"section\">\n        <h2>Shipment Results</h2>\n        <div className=\"table-wrapper\">\n          <table className=\"table\">\n            <thead>\n              <tr>\n                <th>Tracking</th>\n                <th>Reference</th>\n                <th>Status</th>\n                <th>Service</th>\n                <th>Sender</th>\n                <th>Recipient</th>\n                <th>Pickup</th>\n                <th>ETA</th>\n                <th>Last Hub</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredShipments.map((shipment) => (\n                <tr key={shipment.tracking_number}>\n                  <td>{shipment.tracking_number}</td>\n                  <td>{shipment.reference_number}</td>\n                  <td>\n                    <span className=\"badge\">{shipment.shipment_status}</span>\n                  </td>\n                  <td>{shipment.service_type}</td>\n                  <td>\n                    {shipment.sender_name} ({shipment.sender_country})\n                  </td>\n                  <td>\n                    {shipment.recipient_name} ({shipment.recipient_country})\n                  </td>\n                  <td>{shipment.pickup_timestamp}</td>\n                  <td>{shipment.estimated_delivery}</td>\n                  <td>{shipment.last_hub_code}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </section>\n    </div>\n  );\n}\n"
))
